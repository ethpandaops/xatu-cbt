syntax = "proto3";

package cbt;

import "common.proto";
import "google/protobuf/wrappers.proto";
import "google/api/annotations.proto";
import "google/api/field_behavior.proto";
import "clickhouse/annotations.proto";

option go_package = "github.com/ethpandaops/xatu-cbt/pkg/proto/clickhouse";
// Block first seen statistics by node aggregated by day

message FctBlockFirstSeenByNodeDaily {
  // Timestamp when the record was last updated
  uint32 updated_date_time = 11;
  // Calendar day (UTC)
  string day = 12;
  // Start of day at midnight UTC
  uint32 day_start_date_time = 13;
  // Username of the node
  string username = 14;
  // ID of the node
  string node_id = 15;
  // Classification of the node, e.g. "individual", "corporate", "internal" (aka ethPandaOps) or "unclassified"
  string classification = 16;
  // Name of the client
  string meta_client_name = 17;
  // Implementation of the client
  string meta_client_implementation = 18;
  // City of the client
  string meta_client_geo_city = 19;
  // Country of the client
  string meta_client_geo_country = 20;
  // Country code of the client
  string meta_client_geo_country_code = 21;
  // Continent code of the client
  string meta_client_geo_continent_code = 22;
  // Longitude of the client
  google.protobuf.DoubleValue meta_client_geo_longitude = 23;
  // Latitude of the client
  google.protobuf.DoubleValue meta_client_geo_latitude = 24;
  // Autonomous system number of the client
  google.protobuf.UInt32Value meta_client_geo_autonomous_system_number = 25;
  // Autonomous system organization of the client
  google.protobuf.StringValue meta_client_geo_autonomous_system_organization = 26;
  // Minimum slot number in this day
  uint64 min_slot = 27;
  // Maximum slot number in this day
  uint64 max_slot = 28;
  // Number of epochs in this day
  uint32 epoch_count = 29;
  // Number of slots with blocks seen in this day
  uint32 slot_count = 30;
  // Minimum time from slot start for the node to see a block (milliseconds)
  uint32 min_seen_slot_start_diff_ms = 31;
  // 5th percentile time from slot start (milliseconds)
  uint32 p05_seen_slot_start_diff_ms = 32;
  // Median (p50) time from slot start (milliseconds)
  uint32 p50_seen_slot_start_diff_ms = 33;
  // Average time from slot start (milliseconds)
  uint32 avg_seen_slot_start_diff_ms = 34;
  // 90th percentile time from slot start (milliseconds)
  uint32 p90_seen_slot_start_diff_ms = 35;
  // 95th percentile time from slot start (milliseconds)
  uint32 p95_seen_slot_start_diff_ms = 36;
  // 99th percentile time from slot start (milliseconds)
  uint32 p99_seen_slot_start_diff_ms = 37;
  // Maximum time from slot start (milliseconds)
  uint32 max_seen_slot_start_diff_ms = 38;
}

// Request for listing fct_block_first_seen_by_node_daily records
message ListFctBlockFirstSeenByNodeDailyRequest {
  // Filter by day - Calendar day (UTC) (PRIMARY KEY - required)
  StringFilter day = 1 [(google.api.field_behavior) = REQUIRED, (clickhouse.v1.required_group) = "primary_key"];

  // Filter by meta_client_name - Name of the client (ORDER BY column 2 - optional)
  StringFilter meta_client_name = 2 [(google.api.field_behavior) = OPTIONAL];

  // Filter by updated_date_time - Timestamp when the record was last updated (optional)
  UInt32Filter updated_date_time = 3 [(google.api.field_behavior) = OPTIONAL];
  // Filter by day_start_date_time - Start of day at midnight UTC (optional)
  UInt32Filter day_start_date_time = 4 [(google.api.field_behavior) = OPTIONAL];
  // Filter by username - Username of the node (optional)
  StringFilter username = 5 [(google.api.field_behavior) = OPTIONAL];
  // Filter by node_id - ID of the node (optional)
  StringFilter node_id = 6 [(google.api.field_behavior) = OPTIONAL];
  // Filter by classification - Classification of the node, e.g. "individual", "corporate", "internal" (aka ethPandaOps) or "unclassified" (optional)
  StringFilter classification = 7 [(google.api.field_behavior) = OPTIONAL];
  // Filter by meta_client_implementation - Implementation of the client (optional)
  StringFilter meta_client_implementation = 8 [(google.api.field_behavior) = OPTIONAL];
  // Filter by meta_client_geo_city - City of the client (optional)
  StringFilter meta_client_geo_city = 9 [(google.api.field_behavior) = OPTIONAL];
  // Filter by meta_client_geo_country - Country of the client (optional)
  StringFilter meta_client_geo_country = 10 [(google.api.field_behavior) = OPTIONAL];
  // Filter by meta_client_geo_country_code - Country code of the client (optional)
  StringFilter meta_client_geo_country_code = 11 [(google.api.field_behavior) = OPTIONAL];
  // Filter by meta_client_geo_continent_code - Continent code of the client (optional)
  StringFilter meta_client_geo_continent_code = 12 [(google.api.field_behavior) = OPTIONAL];
  // Filter by meta_client_geo_longitude - Longitude of the client (optional)
  google.protobuf.DoubleValue meta_client_geo_longitude = 13 [(google.api.field_behavior) = OPTIONAL];
  // Filter by meta_client_geo_latitude - Latitude of the client (optional)
  google.protobuf.DoubleValue meta_client_geo_latitude = 14 [(google.api.field_behavior) = OPTIONAL];
  // Filter by meta_client_geo_autonomous_system_number - Autonomous system number of the client (optional)
  NullableUInt32Filter meta_client_geo_autonomous_system_number = 15 [(google.api.field_behavior) = OPTIONAL];
  // Filter by meta_client_geo_autonomous_system_organization - Autonomous system organization of the client (optional)
  NullableStringFilter meta_client_geo_autonomous_system_organization = 16 [(google.api.field_behavior) = OPTIONAL];
  // Filter by min_slot - Minimum slot number in this day (optional)
  UInt64Filter min_slot = 17 [(google.api.field_behavior) = OPTIONAL];
  // Filter by max_slot - Maximum slot number in this day (optional)
  UInt64Filter max_slot = 18 [(google.api.field_behavior) = OPTIONAL];
  // Filter by epoch_count - Number of epochs in this day (optional)
  UInt32Filter epoch_count = 19 [(google.api.field_behavior) = OPTIONAL];
  // Filter by slot_count - Number of slots with blocks seen in this day (optional)
  UInt32Filter slot_count = 20 [(google.api.field_behavior) = OPTIONAL];
  // Filter by min_seen_slot_start_diff_ms - Minimum time from slot start for the node to see a block (milliseconds) (optional)
  UInt32Filter min_seen_slot_start_diff_ms = 21 [(google.api.field_behavior) = OPTIONAL];
  // Filter by p05_seen_slot_start_diff_ms - 5th percentile time from slot start (milliseconds) (optional)
  UInt32Filter p05_seen_slot_start_diff_ms = 22 [(google.api.field_behavior) = OPTIONAL];
  // Filter by p50_seen_slot_start_diff_ms - Median (p50) time from slot start (milliseconds) (optional)
  UInt32Filter p50_seen_slot_start_diff_ms = 23 [(google.api.field_behavior) = OPTIONAL];
  // Filter by avg_seen_slot_start_diff_ms - Average time from slot start (milliseconds) (optional)
  UInt32Filter avg_seen_slot_start_diff_ms = 24 [(google.api.field_behavior) = OPTIONAL];
  // Filter by p90_seen_slot_start_diff_ms - 90th percentile time from slot start (milliseconds) (optional)
  UInt32Filter p90_seen_slot_start_diff_ms = 25 [(google.api.field_behavior) = OPTIONAL];
  // Filter by p95_seen_slot_start_diff_ms - 95th percentile time from slot start (milliseconds) (optional)
  UInt32Filter p95_seen_slot_start_diff_ms = 26 [(google.api.field_behavior) = OPTIONAL];
  // Filter by p99_seen_slot_start_diff_ms - 99th percentile time from slot start (milliseconds) (optional)
  UInt32Filter p99_seen_slot_start_diff_ms = 27 [(google.api.field_behavior) = OPTIONAL];
  // Filter by max_seen_slot_start_diff_ms - Maximum time from slot start (milliseconds) (optional)
  UInt32Filter max_seen_slot_start_diff_ms = 28 [(google.api.field_behavior) = OPTIONAL];

  // The maximum number of fct_block_first_seen_by_node_daily to return.
  // If unspecified, at most 100 items will be returned.
  // The maximum value is 10000; values above 10000 will be coerced to 10000.
  int32 page_size = 29 [(google.api.field_behavior) = OPTIONAL];
  // A page token, received from a previous `ListFctBlockFirstSeenByNodeDaily` call.
  // Provide this to retrieve the subsequent page.
  string page_token = 30 [(google.api.field_behavior) = OPTIONAL];
  // The order of results. Format: comma-separated list of fields.
  // Example: "foo,bar" or "foo desc,bar" for descending order on foo.
  // If unspecified, results will be returned in the default order.
  string order_by = 31 [(google.api.field_behavior) = OPTIONAL];
}

// Response for listing fct_block_first_seen_by_node_daily records
message ListFctBlockFirstSeenByNodeDailyResponse {
  // The list of fct_block_first_seen_by_node_daily.
  repeated FctBlockFirstSeenByNodeDaily fct_block_first_seen_by_node_daily = 1;
  // A token, which can be sent as `page_token` to retrieve the next page.
  // If this field is omitted, there are no subsequent pages.
  string next_page_token = 2;
}

// Request for getting a single fct_block_first_seen_by_node_daily record by primary key
message GetFctBlockFirstSeenByNodeDailyRequest {
  // Calendar day (UTC)
  string day = 1; // Primary key (required)
}

// Response for getting a single fct_block_first_seen_by_node_daily record
message GetFctBlockFirstSeenByNodeDailyResponse {
  FctBlockFirstSeenByNodeDaily item = 1;
}

// Query fct_block_first_seen_by_node_daily data
service FctBlockFirstSeenByNodeDailyService {
  // List records | Retrieve paginated results with optional filtering
  rpc List(ListFctBlockFirstSeenByNodeDailyRequest) returns (ListFctBlockFirstSeenByNodeDailyResponse) {
    option (google.api.http) = {
      get: "/api/v1/fct_block_first_seen_by_node_daily"
    };
  }
  // Get record | Retrieve a single record by day
  rpc Get(GetFctBlockFirstSeenByNodeDailyRequest) returns (GetFctBlockFirstSeenByNodeDailyResponse) {
    option (google.api.http) = {
      get: "/api/v1/fct_block_first_seen_by_node_daily/{day}"
    };
  }
}
