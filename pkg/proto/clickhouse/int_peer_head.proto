syntax = "proto3";

package cbt;

import "common.proto";
import "google/protobuf/wrappers.proto";

option go_package = "github.com/ethpandaops/xatu-cbt/pkg/proto/clickhouse";
// Per-peer head observations from handle_status events, enriched with metadata

message IntPeerHead {
  // Timestamp when the record was last updated
  uint32 updated_date_time = 11;
  // Timestamp when the status was observed
  uint32 event_date_time = 12;
  // Unique key for the peer
  string peer_id_unique_key = 13;
  // The head slot reported by the peer
  uint32 head_slot = 14;
  // The head block root reported by the peer
  string head_root = 15;
  // The fork digest reported by the peer
  string fork_digest = 16;
  // The finalized epoch reported by the peer
  google.protobuf.UInt32Value finalized_epoch = 17;
  // Client implementation (e.g., lighthouse, prysm)
  string client = 18;
  // Client version
  string client_version = 19;
  // Platform/OS
  string platform = 20;
  // Country name
  string country = 21;
  // Country code
  string country_code = 22;
  // Continent code
  string continent_code = 23;
}

// Request for listing int_peer_head records
message ListIntPeerHeadRequest {
  // Filter by head_slot - The head slot reported by the peer (PRIMARY KEY - required)
  UInt32Filter head_slot = 1;

  // Filter by peer_id_unique_key - Unique key for the peer (ORDER BY column 2 - optional)
  StringFilter peer_id_unique_key = 2;

  // Filter by updated_date_time - Timestamp when the record was last updated (optional)
  UInt32Filter updated_date_time = 3;
  // Filter by event_date_time - Timestamp when the status was observed (optional)
  UInt32Filter event_date_time = 4;
  // Filter by head_root - The head block root reported by the peer (optional)
  StringFilter head_root = 5;
  // Filter by fork_digest - The fork digest reported by the peer (optional)
  StringFilter fork_digest = 6;
  // Filter by finalized_epoch - The finalized epoch reported by the peer (optional)
  NullableUInt32Filter finalized_epoch = 7;
  // Filter by client - Client implementation (e.g., lighthouse, prysm) (optional)
  StringFilter client = 8;
  // Filter by client_version - Client version (optional)
  StringFilter client_version = 9;
  // Filter by platform - Platform/OS (optional)
  StringFilter platform = 10;
  // Filter by country - Country name (optional)
  StringFilter country = 11;
  // Filter by country_code - Country code (optional)
  StringFilter country_code = 12;
  // Filter by continent_code - Continent code (optional)
  StringFilter continent_code = 13;

  // The maximum number of int_peer_head to return.
  // If unspecified, at most 100 items will be returned.
  // The maximum value is 10000; values above 10000 will be coerced to 10000.
  int32 page_size = 14;
  // A page token, received from a previous `ListIntPeerHead` call.
  // Provide this to retrieve the subsequent page.
  string page_token = 15;
  // The order of results. Format: comma-separated list of fields.
  // Example: "foo,bar" or "foo desc,bar" for descending order on foo.
  // If unspecified, results will be returned in the default order.
  string order_by = 16;
}

// Response for listing int_peer_head records
message ListIntPeerHeadResponse {
  // The list of int_peer_head.
  repeated IntPeerHead int_peer_head = 1;
  // A token, which can be sent as `page_token` to retrieve the next page.
  // If this field is omitted, there are no subsequent pages.
  string next_page_token = 2;
}

// Request for getting a single int_peer_head record by primary key
message GetIntPeerHeadRequest {
  // The head slot reported by the peer
  uint32 head_slot = 1; // Primary key (required)
}

// Response for getting a single int_peer_head record
message GetIntPeerHeadResponse {
  IntPeerHead item = 1;
}

// Query int_peer_head data
service IntPeerHeadService {
  // List records | Retrieve paginated results with optional filtering
  rpc List(ListIntPeerHeadRequest) returns (ListIntPeerHeadResponse);
  // Get record | Retrieve a single record by primary key
  rpc Get(GetIntPeerHeadRequest) returns (GetIntPeerHeadResponse);
}
