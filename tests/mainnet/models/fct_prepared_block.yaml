model: fct_prepared_block
network: mainnet
external_data:
    beacon_api_eth_v3_validator_block:
        url: https://data.ethpandaops.io/xatu-cbt/tests/mainnet/fct_prepared_block_beacon_api_eth_v3_validator_block.parquet
        network_column: meta_network_name
assertions:
    - name: Row count should be greater than zero
      sql: |
        SELECT COUNT(*) AS row_count FROM fct_prepared_block FINAL
      assertions:
        - type: greater_than
          column: row_count
          value: 0
    - name: No null slot values
      sql: |
        SELECT COUNT(*) AS bad_rows FROM fct_prepared_block FINAL
        WHERE slot IS NULL OR slot = 0
      assertions:
        - type: equals
          column: bad_rows
          value: 0
    - name: No null slot_start_date_time values
      sql: |
        SELECT COUNT(*) AS bad_rows FROM fct_prepared_block FINAL
        WHERE slot_start_date_time IS NULL OR slot_start_date_time = toDateTime('1970-01-01 00:00:00')
      assertions:
        - type: equals
          column: bad_rows
          value: 0
    - name: No negative execution_payload_gas_limit values
      sql: |
        SELECT COUNT(*) AS bad_rows FROM fct_prepared_block FINAL
        WHERE execution_payload_gas_limit < 0
      assertions:
        - type: equals
          column: bad_rows
          value: 0
    - name: No negative execution_payload_gas_used values
      sql: |
        SELECT COUNT(*) AS bad_rows FROM fct_prepared_block FINAL
        WHERE execution_payload_gas_used < 0
      assertions:
        - type: equals
          column: bad_rows
          value: 0
    - name: Gas used should not exceed gas limit
      sql: |
        SELECT COUNT(*) AS bad_rows FROM fct_prepared_block FINAL
        WHERE execution_payload_gas_used > execution_payload_gas_limit
      assertions:
        - type: equals
          column: bad_rows
          value: 0
    - name: No negative execution_payload_transactions_count values
      sql: |
        SELECT COUNT(*) AS bad_rows FROM fct_prepared_block FINAL
        WHERE execution_payload_transactions_count < 0
      assertions:
        - type: equals
          column: bad_rows
          value: 0
    - name: Compressed block bytes should not exceed total block bytes
      sql: |
        SELECT COUNT(*) AS bad_rows FROM fct_prepared_block FINAL
        WHERE block_total_bytes_compressed > block_total_bytes
      assertions:
        - type: equals
          column: bad_rows
          value: 0
    - name: No negative block_total_bytes values
      sql: |
        SELECT COUNT(*) AS bad_rows FROM fct_prepared_block FINAL
        WHERE block_total_bytes < 0
      assertions:
        - type: equals
          column: bad_rows
          value: 0
    - name: No empty meta_client_name values
      sql: |
        SELECT COUNT(*) AS bad_rows FROM fct_prepared_block FINAL
        WHERE meta_client_name IS NULL OR meta_client_name = ''
      assertions:
        - type: equals
          column: bad_rows
          value: 0
