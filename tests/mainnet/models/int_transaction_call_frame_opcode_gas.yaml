model: int_transaction_call_frame_opcode_gas
network: mainnet
external_data:
    canonical_execution_transaction_structlog_agg:
        url: https://data.ethpandaops.io/xatu-cbt/tests/mainnet/int_transaction_call_frame_opcode_gas_canonical_execution_transaction_structlog_agg.parquet
        network_column: meta_network_name
assertions:
    - name: Row count should be greater than zero
      sql: |
        SELECT COUNT(*) AS count FROM int_transaction_call_frame_opcode_gas FINAL
      assertions:
        - type: greater_than
          column: count
          value: 0
    - name: Opcode count should always be positive
      sql: |
        SELECT COUNT(*) AS invalid_count
        FROM int_transaction_call_frame_opcode_gas FINAL
        WHERE count <= 0
      assertions:
        - type: equals
          column: invalid_count
          value: 0
    - name: Gas should be non-negative
      sql: |
        SELECT COUNT(*) AS count
        FROM int_transaction_call_frame_opcode_gas FINAL
        WHERE gas < 0
      assertions:
        - type: equals
          column: count
          value: 0
    - name: Gas cumulative should be greater than or equal to gas
      sql: |
        SELECT COUNT(*) AS count
        FROM int_transaction_call_frame_opcode_gas FINAL
        WHERE gas_cumulative < gas
      assertions:
        - type: equals
          column: count
          value: 0
    - name: Opcode should never be empty
      sql: |
        SELECT COUNT(*) AS count
        FROM int_transaction_call_frame_opcode_gas FINAL
        WHERE opcode = ''
      assertions:
        - type: equals
          column: count
          value: 0
    - name: Error count should be non-negative
      sql: |
        SELECT COUNT(*) AS count
        FROM int_transaction_call_frame_opcode_gas FINAL
        WHERE error_count < 0
      assertions:
        - type: equals
          column: count
          value: 0
    - name: Block number should be positive
      sql: |
        SELECT MIN(block_number) AS min_block
        FROM int_transaction_call_frame_opcode_gas FINAL
      assertions:
        - type: greater_than
          column: min_block
          value: 0
    - name: Call frame ID should be non-negative
      sql: |
        SELECT COUNT(*) AS count
        FROM int_transaction_call_frame_opcode_gas FINAL
        WHERE call_frame_id < 0
      assertions:
        - type: equals
          column: count
          value: 0
    - name: Memory expansion gas should be non-negative
      sql: |
        SELECT COUNT(*) AS count
        FROM int_transaction_call_frame_opcode_gas FINAL
        WHERE memory_expansion_gas < 0
      assertions:
        - type: equals
          column: count
          value: 0
    - name: Cold access count should be non-negative
      sql: |
        SELECT COUNT(*) AS count
        FROM int_transaction_call_frame_opcode_gas FINAL
        WHERE cold_access_count < 0
      assertions:
        - type: equals
          column: count
          value: 0
