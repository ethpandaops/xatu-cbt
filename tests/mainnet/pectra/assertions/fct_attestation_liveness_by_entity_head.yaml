- name: "Expected size"
  sql: |
    SELECT
      COUNT(*) AS count,
      MIN(slot) AS min,
      MAX(slot) AS max
    FROM
      fct_attestation_liveness_by_entity_head FINAL
  expected:
    count: 40
    min: "12145370"
    max: "12145389"
- name: "Expected status values"
  sql: |
    SELECT
      COUNT(DISTINCT status) AS status_count
    FROM
      fct_attestation_liveness_by_entity_head FINAL
  expected:
    status_count: 2
- name: "Verify status values are attested or missed"
  sql: |
    SELECT
      COUNT(*) as valid_statuses
    FROM
      fct_attestation_liveness_by_entity_head FINAL
    WHERE
      status IN ('attested', 'missed')
  expected:
    valid_statuses: 40
- name: "Expected distinct slots"
  sql: |
    SELECT
      COUNT(DISTINCT slot) AS slot_count
    FROM
      fct_attestation_liveness_by_entity_head FINAL
  expected:
    slot_count: 20
- name: "No NULL entities"
  sql: |
    SELECT
      COUNT(*) as null_entity_count
    FROM
      fct_attestation_liveness_by_entity_head FINAL
    WHERE
      entity IS NULL
  expected:
    null_entity_count: 0
- name: "Entity defaults to unknown when not mapped"
  sql: |
    SELECT
      COUNT(DISTINCT entity) as entity_count,
      SUM(CASE WHEN entity = 'unknown' THEN 1 ELSE 0 END) as unknown_count
    FROM
      fct_attestation_liveness_by_entity_head FINAL
  expected:
    entity_count: 1
    unknown_count: 40
- name: "Total attestation count matches validator table"
  sql: |
    SELECT
      SUM(attestation_count) AS total_from_aggregated
    FROM
      fct_attestation_liveness_by_entity_head FINAL
  expected:
    total_from_aggregated: 685007
- name: "Expected admin bounds"
  sql: |
    SELECT
      fromUnixTimestamp(MAX(position + interval)) AS max,
      fromUnixTimestamp(MIN(position)) AS min
    FROM
      admin_cbt_incremental FINAL
    WHERE
      table = 'fct_attestation_liveness_by_entity_head'
  expected:
    max: "2025-07-15T08:38:11Z"
    min: "2025-07-15T08:34:23Z"
