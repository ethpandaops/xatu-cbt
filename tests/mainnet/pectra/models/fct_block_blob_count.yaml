model: fct_block_blob_count
network: mainnet
spec: pectra
external_data:
    canonical_beacon_blob_sidecar:
        url: https://data.ethpandaops.io/xatu-cbt/pectra/canonical_beacon_blob_sidecar.parquet
        network_column: meta_network_name
    beacon_api_eth_v1_events_blob_sidecar:
        url: https://data.ethpandaops.io/xatu-cbt/pectra/beacon_api_eth_v1_events_blob_sidecar.parquet
        network_column: meta_network_name
    beacon_api_eth_v1_events_data_column_sidecar:
        url: https://data.ethpandaops.io/xatu-cbt/pectra/beacon_api_eth_v1_events_data_column_sidecar.parquet
        network_column: meta_network_name
    libp2p_gossipsub_data_column_sidecar:
        url: https://data.ethpandaops.io/xatu-cbt/pectra/libp2p_gossipsub_data_column_sidecar.parquet
        network_column: meta_network_name
    libp2p_gossipsub_blob_sidecar:
        url: https://data.ethpandaops.io/xatu-cbt/pectra/libp2p_gossipsub_blob_sidecar.parquet
        network_column: meta_network_name
assertions:
    - name: Contains orphaned block
      sql: |
        SELECT
          COUNT(*) AS count
        FROM
          fct_block_blob_count FINAL
        WHERE
          status = 'orphaned'
      expected:
        count: 10
    - name: Expected bounds and size
      sql: |
        SELECT
          COUNT(*) AS count,
          MIN(slot) AS min,
          MAX(slot) AS max
        FROM
          fct_block_blob_count FINAL
      expected:
        count: 19
        max: "12145388"
        min: "12145371"
    - name: Expected admin bounds
      sql: |
        SELECT
          fromUnixTimestamp(MAX(position + interval)) AS max,
          fromUnixTimestamp(MIN(position)) AS min
        FROM
          admin_cbt_incremental FINAL
        WHERE
          table = 'fct_block_blob_count'
      expected:
        max: "2025-07-15T08:38:11Z"
        min: "2025-07-15T08:34:35Z"
