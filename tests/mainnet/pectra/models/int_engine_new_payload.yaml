model: int_engine_new_payload
network: mainnet
spec: pectra
external_data:
  beacon_api_eth_v2_beacon_block:
    url: https://data.ethpandaops.io/xatu-cbt/mainnet/pectra/int_engine_new_payload_beacon_api_eth_v2_beacon_block.parquet
    network_column: meta_network_name
  execution_engine_new_payload:
    url: https://data.ethpandaops.io/xatu-cbt/mainnet/pectra/int_engine_new_payload_execution_engine_new_payload.parquet
    network_column: meta_network_name
assertions:
  - name: Row count should be non-negative
    sql: |
      SELECT COUNT(*) AS count FROM int_engine_new_payload FINAL
    assertions:
      - type: greater_than_or_equal
        column: count
        value: 0
  - name: All slots should be greater than zero
    sql: |
      SELECT COUNT(*) AS count FROM int_engine_new_payload FINAL WHERE slot <= 0
    assertions:
      - type: equals
        column: count
        value: 0
  - name: All block hashes should not be empty
    sql: |
      SELECT COUNT(*) AS count FROM int_engine_new_payload FINAL WHERE block_hash = ''
    assertions:
      - type: equals
        column: count
        value: 0
  - name: Duration ms should be non-negative
    sql: |
      SELECT COUNT(*) AS count FROM int_engine_new_payload FINAL WHERE duration_ms < 0
    assertions:
      - type: equals
        column: count
        value: 0
  - name: Gas used should be non-negative
    sql: |
      SELECT COUNT(*) AS count FROM int_engine_new_payload FINAL WHERE gas_used < 0
    assertions:
      - type: equals
        column: count
        value: 0
  - name: Gas limit should be greater than zero
    sql: |
      SELECT COUNT(*) AS count FROM int_engine_new_payload FINAL WHERE gas_limit <= 0
    assertions:
      - type: equals
        column: count
        value: 0
  - name: Transaction count should be non-negative
    sql: |
      SELECT COUNT(*) AS count FROM int_engine_new_payload FINAL WHERE tx_count < 0
    assertions:
      - type: equals
        column: count
        value: 0
  - name: Blob count should be non-negative
    sql: |
      SELECT COUNT(*) AS count FROM int_engine_new_payload FINAL WHERE blob_count < 0
    assertions:
      - type: equals
        column: count
        value: 0
  - name: Meta client name should not be empty
    sql: |
      SELECT COUNT(*) AS count FROM int_engine_new_payload FINAL WHERE meta_client_name = ''
    assertions:
      - type: equals
        column: count
        value: 0
  - name: Slot should be consistent with epoch
    sql: |
      SELECT COUNT(*) AS count FROM int_engine_new_payload FINAL WHERE slot < epoch * 32 OR slot > epoch * 32 + 31
    assertions:
      - type: equals
        column: count
        value: 0
