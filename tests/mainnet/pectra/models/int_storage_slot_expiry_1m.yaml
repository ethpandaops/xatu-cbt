model: int_storage_slot_expiry_1m
network: mainnet
spec: pectra
external_data:
    canonical_execution_block:
        url: https://data.ethpandaops.io/xatu-cbt/mainnet/pectra/canonical_execution_block.parquet
        network_column: meta_network_name
    canonical_execution_storage_diffs:
        url: https://data.ethpandaops.io/xatu-cbt/mainnet/pectra/canonical_execution_storage_diffs.parquet
        network_column: meta_network_name
    canonical_execution_storage_reads:
        url: https://data.ethpandaops.io/xatu-cbt/mainnet/pectra/canonical_execution_storage_reads.parquet
        network_column: meta_network_name
assertions:
    - name: Expected admin bounds exist
      sql: |
        SELECT
          COUNT(*) AS count
        FROM
          admin_cbt_incremental FINAL
        WHERE
          table = 'int_storage_slot_expiry_1m'
      expected:
        count: 1
    - name: Case 12 genesis-era 1m expiry exists
      sql: |
        SELECT
          block_number,
          address,
          effective_bytes
        FROM int_storage_slot_expiry_1m FINAL
        WHERE address = '0x630ea66c8c5dc205d45a978573fa86df5af1fe7a'
          AND block_number = 199079
        ORDER BY slot_key
        LIMIT 1
      expected:
        block_number: "199079"
        address: "0x630ea66c8c5dc205d45a978573fa86df5af1fe7a"
        effective_bytes: "1"
    - name: Case 7 1m expiry exists (waterfall base)
      sql: |
        SELECT
          block_number,
          touch_block,
          effective_bytes
        FROM int_storage_slot_expiry_1m FINAL
        WHERE address = '0x86fa049857e0209aa7d9e616f7eb3b3b78ecfdb0'
          AND slot_key = '0x9ff87960f26fb9e2553cb67c4d27896d4c8dc8fe6f403d1cc6ba9b6fe71a8d7d'
      expected:
        block_number: "4328143"
        touch_block: "4227606"
        effective_bytes: "8"
