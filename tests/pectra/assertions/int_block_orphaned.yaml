- name: "no canonical overlap"
  sql: |
    SELECT
      count() AS count
    FROM
      int_block_orphaned o
      INNER JOIN canonical_beacon_block c
        ON o.slot = c.slot AND o.block_root = c.block_root
  expected:
    count: 0
- name: "no duplicates per (slot, block_root)"
  sql: |
    SELECT
      count() AS count
    FROM (
      SELECT slot, block_root, count() AS c
      FROM int_block_orphaned
      GROUP BY slot, block_root
      HAVING c > 1
    )
  expected:
    count: 0
- name: "only up to max canonical epoch"
  sql: |
    SELECT
      count() AS count
    FROM int_block_orphaned
    WHERE epoch > (SELECT max(epoch) FROM canonical_beacon_block)
  expected:
    count: 0
- name: "no null or empty block_root"
  sql: |
    SELECT
      count() AS count
    FROM int_block_orphaned
    WHERE block_root IS NULL OR block_root = ''
  expected:
    count: 0
- name: "Expected bounds and size"
  sql: |
    SELECT
      COUNT(*) AS count,
      MIN(slot_start_date_time) AS min,
      MAX(slot_start_date_time) AS max
    FROM
      int_block_orphaned FINAL
  expected:
    # TODO: get a good block range
    count: 1
    min: "2025-07-15T08:34:47Z"
    max: "2025-07-15T08:34:47Z"
- name: "Expected admin bounds"
  sql: |
    SELECT
      fromUnixTimestamp(MAX(position + interval)) AS max,
      fromUnixTimestamp(MIN(position)) AS min
    FROM
      admin_cbt FINAL
    WHERE
      table = 'int_block_orphaned'
  expected:
    max: "2025-07-15T08:38:23Z"
    min: "2025-07-15T08:34:23Z"

