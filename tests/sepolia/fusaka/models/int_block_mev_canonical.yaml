model: int_block_mev_canonical
network: sepolia
spec: fusaka
external_data:
    canonical_beacon_block:
        url: https://data.ethpandaops.io/xatu-cbt/sepolia/fusaka/int_block_mev_canonical_canonical_beacon_block.parquet
        network_column: meta_network_name
    mev_relay_bid_trace:
        url: https://data.ethpandaops.io/xatu-cbt/sepolia/fusaka/int_block_mev_canonical_mev_relay_bid_trace.parquet
        network_column: meta_network_name
    mev_relay_proposer_payload_delivered:
        url: https://data.ethpandaops.io/xatu-cbt/sepolia/fusaka/int_block_mev_canonical_mev_relay_proposer_payload_delivered.parquet
        network_column: meta_network_name
assertions:
    - name: Row count should be greater than zero
      sql: |
        SELECT COUNT(*) AS count FROM int_block_mev_canonical FINAL
      assertions:
        - type: greater_than
          column: count
          value: 0
    - name: Slot values should be non-negative
      sql: |
        SELECT COUNT(*) AS invalid_count FROM int_block_mev_canonical FINAL WHERE slot < 0
      assertions:
        - type: equals
          column: invalid_count
          value: 0
    - name: Epoch values should be non-negative
      sql: |
        SELECT COUNT(*) AS invalid_count FROM int_block_mev_canonical FINAL WHERE epoch < 0
      assertions:
        - type: equals
          column: invalid_count
          value: 0
    - name: Block number should be non-negative
      sql: |
        SELECT COUNT(*) AS invalid_count FROM int_block_mev_canonical FINAL WHERE block_number < 0
      assertions:
        - type: equals
          column: invalid_count
          value: 0
    - name: Gas used should not exceed gas limit
      sql: |
        SELECT COUNT(*) AS invalid_count FROM int_block_mev_canonical FINAL WHERE gas_used > gas_limit
      assertions:
        - type: equals
          column: invalid_count
          value: 0
    - name: Transaction count should be non-negative
      sql: |
        SELECT COUNT(*) AS invalid_count FROM int_block_mev_canonical FINAL WHERE transaction_count < 0
      assertions:
        - type: equals
          column: invalid_count
          value: 0
    - name: Value should be non-negative when present
      sql: |
        SELECT COUNT(*) AS invalid_count FROM int_block_mev_canonical FINAL WHERE value IS NOT NULL AND value < 0
      assertions:
        - type: equals
          column: invalid_count
          value: 0
    - name: Relay names array should not be empty
      sql: |
        SELECT COUNT(*) AS invalid_count FROM int_block_mev_canonical FINAL WHERE length(relay_names) = 0
      assertions:
        - type: equals
          column: invalid_count
          value: 0
    - name: Block root should not be null
      sql: |
        SELECT COUNT(*) AS null_count FROM int_block_mev_canonical FINAL WHERE block_root IS NULL OR block_root = ''
      assertions:
        - type: equals
          column: null_count
          value: 0
    - name: Block hash should not be null
      sql: |
        SELECT COUNT(*) AS null_count FROM int_block_mev_canonical FINAL WHERE block_hash IS NULL OR block_hash = ''
      assertions:
        - type: equals
          column: null_count
          value: 0
